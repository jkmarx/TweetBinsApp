"use strict";function AuthFactory(a,b,c){function d(b){return console.log(b),console.log("In authfactory login"),a.post(c+"/login",b).success(function(a){k(a)})}function e(){{var d=JSON.parse(b.localStorage.getItem("tb-user"));({headers:{AUTHORIZATION:"Token token="+d.token}}),JSON.parse(b.localStorage.getItem("tb-user")).email}return a.get(c+"/users").then(function(a){console.log(a.data),angular.copy(a.data,i)},h)}function f(){{var d=JSON.parse(b.localStorage.getItem("tb-user"));({headers:{AUTHORIZATION:"Token token="+d.token}})}return a.get(c+"/logout").success(function(a){b.localStorage.removeItem("tb-user")})}function g(){var a=JSON.parse(b.localStorage.getItem("tb-user"));return a?!!a.token:!1}function h(a){console.log("in requestFailure"),console.log(a)}var i={},j=function(){},k=function(c){b.localStorage.setItem("tb-user",JSON.stringify(c)),a.defaults.headers.common.Authorization="Token token="+c.token},l=function(d){var e=JSON.parse(b.localStorage.getItem("tb-user")),f=({headers:{AUTHORIZATION:"Token token="+e.token}},{user:d});return a.post(c+"/users/update",f).success(function(a){k(a)}).error(function(a,b,c,d){console.log(a)})},m=function(b){var d={user:b};return a.post(c+"/users",d).success(function(a){k(a)}).error(function(a,b,c,d){console.log(a)})},n=function(d){{var e=JSON.parse(b.localStorage.getItem("tb-user"));({headers:{AUTHORIZATION:"Token token="+e.token}})}return a["delete"](c+"/users").then(function(a){console.log(a)})};return{login:d,logout:f,isAuthenticated:g,clearStorage:j,upsertUser:l,getUserInfo:e,userInfo:i,registerUser:m,deleteUser:n}}function diCategories(){return{restrict:"E",templateUrl:"views/categories.html",scope:{jobs:"="},controller:"CategoriesCtrl",controllerAs:"categoriesCtrl",bindToController:!0}}function diTweets(){return{restrict:"E",templateUrl:"views/tweets.html",scope:{tweets:"=",category:"="},controller:"TweetsCtrl",controllerAs:"tweetsCtrl",bindToController:!0}}function NavbarCtrl(a,b,c){var d=this;d.isLoggedin=function(){return a.isAuthenticated()},d.logout=function(){a.logout().then(function(){b.path("/")})},d.isActive=function(a){return a===b.path()}}function TweetsCtrl(a,b,c){function d(a){var b="";return angular.forEach(a,function(a,c){b+=c+": "+a}),b}function e(){b.setFriend({twitterId:"",category_id:""}),c.setCategory({name:""}),f.serverErrors=!1}var f=this;f.friend=b.friend,f.categories=c.categories,console.log("in tweetsCtrl now!"),b.getTweets().then(function(a){f.tweets=b.tweets}),f.upsertFriend=function(a){var c={};a=JSON.parse("["+a+"]"),c.category_id=a[0],c.twitterId=a[1],b.upsertFriend(c).then(function(){e()},function(a){f.serverErrors=!0,f.serverErrorMsg=d(a.data)})},f.editFriend=function(a){b.setFriend(a)},f.cancel=function(){e()},e()}function tweetsAddLinks(){return function(a){if(a&&a.length>0){for(var b,c=a,d=0;d<a.length;d++){b=a[d].text.replace(/(\r\n|\n|\r)/gm,"").split(" ");for(var e=0;e<b.length;e++)"http://"===b[e].slice(0,7)||"https://"===b[e].slice(0,8)?b[e]="<a href="+b[e]+' target="_blank">'+b[e]+"</a>":"@"===b[e].slice(0,1)?b[e]='<a href="https://twitter.com/'+b[e].slice(1,b[e].length-1)+'" target="_blank">'+b[e]+"</a>":"#"===b[e].slice(0,1)&&(b[e]="<a href='https://twitter.com/hashtag/"+b[e].replace(/[#]/g,"")+"?src=hash' target='_blank'>"+b[e]+"</a>");c[d].text=b.join(" ")}return c}}}function LoginCtrl(a,b,c,d,e){function f(){return console.log("in getCallbackToken"),a.get(e+"/callbacks").then(function(a){console.log(a.data),h(a.data)},g)}function g(a){console.log("in requestFailure"),console.log(a)}function h(b){return console.log(b.token),c.location.href="https://api.twitter.com/oauth/authorize?"+b.token,a.get(e+"/callbacks").then(function(a){console.log(a.data),h(a.data)},g)}var i=this;console.log("in loginctrl"),i.redirectToTwitter=function(){console.log("in redirectToTwitter"),f()}}function LoginAppCtrl(a,b,c){console.log("in loginAppctrl");var d=this;d.login=function(c){console.log("in applogin function"),a.login(c).then(function(a){d.credentials={},b.path("/login")})};d.register=function(c){a.registerUser(c).success(function(a){b.path("/login")}).error(function(a,b,c,d){console.log(a)})}}function UserInfoCtrl(a,b,c){console.log("in UserInfoctrl");var d=this;d.userInfo=a.userInfo,d.userInfo.length>0||a.getUserInfo().then(function(b){d.userInfo=a.userInfo});d.updateUser=function(c){a.upsertUser(c).success(function(a){b.path("/dashboard")}).error(function(a,b,c,d){console.log(a)})},d.deleteUser=function(){a.deleteUser(),b.path("/loginApp")}}function FriendCtrl(a,b,c){function d(a){var b="";return angular.forEach(a,function(a,c){b+=c+": "+a}),b}function e(){a.setFriend({twitterId:"",category_id:""}),f.serverErrors=!1}var f=this;f.friend=a.friend,f.categories=b.categories,f.upsertFriend=function(b){var c={};c.category_id=b[0],c.twitterId=b[1],a.upsertFriend(c).then(function(){e()},function(a){f.serverErrors=!0,f.serverErrorMsg=d(a.data)})},f.editFriend=function(b){a.setFriend(b)},f.deleteFriend=function(b){a.deleteFriend(b),c.reload()},f.cancel=function(){e()},e()}function SaveTweetsCtrl(a,b){function c(a){var b="";return angular.forEach(a,function(a,c){b+=c+": "+a}),b}function d(){e.serverErrors=!1}var e=this;e.saveTweets=b.saveTweets,e.saveTweets.length>0||b.getSaveTweets().then(function(a){e.saveTweets=b.saveTweets}),e.upsertSaveTweet=function(a){b.upsertSaveTweet(a).then(function(){d()},function(a){e.serverErrors=!0,e.serverErrorMsg=c(a.data)})},e.editSaveTweet=function(a){b.setSaveTweet(a)},e.deleteSaveTweet=function(a){b.deleteSaveTweet(a)},e.cancel=function(){d()}}function CategoriesCtrl(a,b,c){function d(a){var b="";return angular.forEach(a,function(a,c){b+=c+": "+a}),b}function e(){c.setCategory({name:""}),f.serverErrors=!1}var f=this;f.category=c.category,a.category=f.category,!f.category||f.category.length>0||c.getCategory().then(function(a){f.category=c.category}),f.categories=c.categories,a.categories=f.categories,!f.categories||f.categories.length>0||c.getCategories().then(function(a){f.categories=c.categories}),f.upsertCategory=function(a){c.upsertCategory(a).then(function(){c.getCategories(),a.id||e()},function(a){f.serverErrors=!0,f.serverErrorMsg=d(a.data)})},f.editCategory=function(a){c.setCategory(a)},f.deleteCategory=function(a){c.deleteCategory(a),b.path("/tweets"),c.getCategories()},f.cancel=function(){e()}}function tweetsFilter(){return function(a,b){var c=[],d=[];if(b.category)for(var e=b.category.friends,f=0;f<e.length;f++)d.push(e[f].twitterId);if(a)for(var g=0;g<a.length;g++){var h=a[g].userId.toString(),i=d.indexOf(h);i>-1&&c.push(a[g])}return c}}function tweetsAddLinks(){return function(a){if(a&&a.length>0){for(var b,c=a,d=0;d<a.length;d++){b=a[d].text.split(" ");for(var e=0;e<b.length;e++)"http://"===b[e].slice(0,7)||"https://"===b[e].slice(0,8)?b[e]="<a href="+b[e]+' target="_blank">'+b[e]+"</a>":"@"===b[e].slice(0,1)?b[e]='<a href="https://twitter.com/'+b[e].slice(1,b[e].length-1)+'" target="_blank">'+b[e]+"</a>":"#"===b[e].slice(0,1)&&(b[e]="<a href='https://twitter.com/hashtag/"+b[e].replace(/[#]/g,"")+"?src=hash' target='_blank'>"+b[e]+"</a>");c[d].text=b.join(" ")}return c}}}angular.module("TweetBinsApp",["ngAnimate","ngResource","ngRoute","ngSanitize","ngCookies","ngTouch"]).run(["$rootScope","$http","$window","$location","AuthFactory","TweetsFactory",function(a,b,c,d,e,f){if(e.isAuthenticated()){var g=JSON.parse(c.localStorage.getItem("tb-user"));b.defaults.headers.common.Authorization="Token token="+g.token}else d.path("/loginApp");a.$on("$routeChangeStart",function(a,b){e.isAuthenticated()||d.path("/loginApp")})}]),angular.module("TweetBinsApp").config(["$routeProvider",function(a){a.when("/login",{templateUrl:"views/login.html",controller:"LoginCtrl"}).when("/loginApp",{templateUrl:"views/login-app.html"}).when("/userAccount",{templateUrl:"views/user-account.html",controller:"UserInfoCtrl"}).when("/tweets",{templateUrl:"views/tweets.html",controller:"TweetsCtrl"}).when("/main",{templateUrl:"views/tweets.html"}).when("/categories/:categoryId",{templateUrl:"views/category.html",controller:"CategoriesCtrl"}).when("/saveTweets",{templateUrl:"views/save-tweets.html",controller:"SaveTweetsCtrl"}).when("/about",{templateUrl:"views/about.html",controller:"AboutCtrl"}).otherwise({redirectTo:"/loginApp"})}]),angular.module("TweetBinsApp").constant("ServerUrl","https://tweetstreams.herokuapp.com"),angular.module("TweetBinsApp").factory("AuthFactory",AuthFactory),AuthFactory.$inject=["$http","$window","ServerUrl"],angular.module("TweetBinsApp").factory("TweetsFactory",["$http","$window","ServerUrl",function(a,b,c){function d(a){console.log(a)}var e={},f=[];console.log("in tweetsFactory");var g=function(){var e=JSON.parse(b.localStorage.getItem("tb-user")),g={headers:{AUTHORIZATION:"Token token="+e.token}};return a.get(c+"/tweets",g).then(function(a){angular.copy(a.data,f)},d)},h=function(a){angular.copy(a,e)},i=function(){var f=JSON.parse(b.localStorage.getItem("tb-user")),g={headers:{AUTHORIZATION:"Token token="+f.token}};return a.get(c+"/friends",g).then(function(a){angular.copy(a.data,e)},d)},j=function(e){{var f={friend:e},g=JSON.parse(b.localStorage.getItem("tb-user"));({headers:{AUTHORIZATION:"Token token="+g.token}})}return e.id?a.put(c+"/friends/"+e.id,f).then(i):a.post(c+"/friends",f).then(function(a){angular.copy(a.data,e)},d)};return{tweets:f,getTweets:g,friend:e,getFriend:i,upsertFriend:j,setFriend:h}}]),angular.module("TweetBinsApp").factory("FriendFactory",["$http","$routeParams","$window","ServerUrl",function(a,b,c,d){function e(a){console.log("in requestFailure"),console.log(a)}var f={};console.log("in friendFactory");var g=function(a){angular.copy(a,f)},h=function(){var b=JSON.parse(c.localStorage.getItem("tb-user")),g={headers:{AUTHORIZATION:"Token token="+b.token}};return a.get(d+"/friends",g).then(function(a){console.log(a.data),angular.copy(a.data,f)},e)},i=function(b){var f={friend:b},g=JSON.parse(c.localStorage.getItem("tb-user")),i={headers:{AUTHORIZATION:"Token token="+g.token}};return b.id?a.put(d+"/friends/"+b.id,f,i).then(h):a.post(d+"/friends",f,i).then(function(a){b.push(a.data)},e)},j=function(b){var e=JSON.parse(c.localStorage.getItem("tb-user")),f={headers:{AUTHORIZATION:"Token token="+e.token}};return a["delete"](d+"/friends/"+b,f).then(function(a){console.log(a)})};return{friend:f,getFriend:h,upsertFriend:i,setFriend:g,deleteFriend:j}}]),angular.module("TweetBinsApp").factory("CategoriesFactory",["$http","$routeParams","$window","ServerUrl",function(a,b,c,d){function e(){var e=JSON.parse(c.localStorage.getItem("tb-user")),f={headers:{AUTHORIZATION:"Token token="+e.token}},h=b.categoryId;return a.get(d+"/categories/"+h,f).then(function(a){angular.copy(a.data,i)},g)}function f(a){for(var b=0;b<h.length;b++)if(h[b].id===a)return b}function g(a){console.log("in requestFailure"),console.log(a)}var h=[],i={};console.log("in categoriesFactory");var j=function(a){angular.copy(a,i)},k=function(){var b=JSON.parse(c.localStorage.getItem("tb-user")),e={headers:{AUTHORIZATION:"Token token="+b.token}};return a.get(d+"/categories",e).then(function(a){console.log(a.data),angular.copy(a.data,h)},g)},l=function(b){var e={category:b},f=JSON.parse(c.localStorage.getItem("tb-user")),i={headers:{AUTHORIZATION:"Token token="+f.token}};return b.id?a.put(d+"/categories/"+b.id,e,i).then(function(a){angular.copy(a.data,b)},g):a.post(d+"/categories",e,i).then(function(a){h.push(a.data)},g)},m=function(b){var e=JSON.parse(c.localStorage.getItem("tb-user")),g={headers:{AUTHORIZATION:"Token token="+e.token}};return a["delete"](d+"/categories/"+b.id,g).then(function(a){h.splice(f(b.id),1)})};return{categories:h,category:i,getCategories:k,upsertCategory:l,deleteCategory:m,getCategory:e,setCategory:j}}]),angular.module("TweetBinsApp").factory("SaveTweetsFactory",["$http","$routeParams","$window","ServerUrl",function(a,b,c,d){function e(){var e=JSON.parse(c.localStorage.getItem("tb-user")),f={headers:{AUTHORIZATION:"Token token="+e.token}},h=b.saveTweetId;return a.get(d+"/save_tweets/"+h,f).then(function(a){angular.copy(a.data,i)},g)}function f(a){for(var b=0;b<h.length;b++)if(h[b].id===a)return b}function g(a){console.log("in requestFailure"),console.log(a)}var h=[],i={};console.log("in saveTweetsFactory");var j=function(a){angular.copy(a,i)},k=function(){var b=JSON.parse(c.localStorage.getItem("tb-user")),e={headers:{AUTHORIZATION:"Token token="+b.token}};return a.get(d+"/save_tweets",e).then(function(a){angular.copy(a.data,h)},g)},l=function(b){var e={save_tweet:b},f=JSON.parse(c.localStorage.getItem("tb-user")),i={headers:{AUTHORIZATION:"Token token="+f.token}};return b.id?a.put(d+"/save_tweets/"+b.id,e,i).then(k):a.post(d+"/save_tweets",e,i).then(function(a){h.push(a.data),console.log(a.data)},g)},m=function(b){var e=JSON.parse(c.localStorage.getItem("tb-user")),g={headers:{AUTHORIZATION:"Token token="+e.token}};return a["delete"](d+"/save_tweets/"+b.id,g).then(function(a){h.splice(f(b.id),1)})};return{saveTweets:h,saveTweet:i,getSaveTweets:k,upsertSaveTweet:l,deleteSaveTweet:m,getSaveTweet:e,setSaveTweet:j}}]),angular.module("TweetBinsApp").directive("loginAppForm",[function(){return{restrict:"E",templateUrl:"views/login-app-form.html",controller:"LoginAppCtrl",controllerAs:"loginAppCtrl",bindToController:!0,scope:{credentials:"="}}}]),angular.module("TweetBinsApp").directive("gaNavbar",[function(){return{restrict:"E",templateUrl:"views/navbar.html",controller:"NavbarCtrl",controllerAs:"NavbarCtrl",bindToController:!0,scope:{},link:function(a,b,c){}}}]),angular.module("TweetBinsApp").directive("diCategories",diCategories),angular.module("TweetBinsApp").directive("signUpForm",[function(){return{restrict:"E",templateUrl:"views/sign-up-form.html",controller:"LoginAppCtrl",controllerAs:"loginAppCtrl",bindToController:!0,scope:{credentials:"="}}}]),angular.module("TweetBinsApp").directive("diTweets",diTweets),angular.module("TweetBinsApp").controller("NavbarCtrl",NavbarCtrl),NavbarCtrl.$inject=["AuthFactory","$location","$scope"],angular.module("TweetBinsApp").controller("TweetsCtrl",TweetsCtrl).filter("tweetsAddLinks",tweetsAddLinks),TweetsCtrl.$inject=["$scope","TweetsFactory","CategoriesFactory"],angular.module("TweetBinsApp").controller("LoginCtrl",LoginCtrl),LoginCtrl.$inject=["$http","$location","$window","$scope","ServerUrl"],angular.module("TweetBinsApp").controller("LoginAppCtrl",LoginAppCtrl),LoginAppCtrl.$inject=["AuthFactory","$location","$scope"],angular.module("TweetBinsApp").controller("UserInfoCtrl",UserInfoCtrl),UserInfoCtrl.$inject=["AuthFactory","$location","$scope"],angular.module("TweetBinsApp").controller("FriendCtrl",FriendCtrl),FriendCtrl.$inject=["FriendFactory","CategoriesFactory","$route"],angular.module("TweetBinsApp").controller("SaveTweetsCtrl",SaveTweetsCtrl),SaveTweetsCtrl.$inject=["$scope","SaveTweetsFactory"],angular.module("TweetBinsApp").controller("AboutCtrl",["$scope",function(a){a.awesomeThings=["HTML5 Boilerplate","AngularJS","Karma"]}]),angular.module("TweetBinsApp").controller("CategoriesCtrl",CategoriesCtrl).filter("tweetsFilter",tweetsFilter).filter("tweetsAddLinks",tweetsAddLinks),CategoriesCtrl.$inject=["$scope","$location","CategoriesFactory"];